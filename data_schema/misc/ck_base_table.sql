----------------------------------------------------------------------------------------
-- 更新分布式表 提示：

-- 1/  on cluster <集群名> 必须写,例如: on cluster replicated
---- ALTER TABLE email_domain_to_company_country_local on cluster replicated UPDATE country='US' where country='美国';

-- 2/ 依靠其他列的内容，更新另外一列，where 必须有 如果对整个表 每一行都应用 使用 where 1=1
---- ALTER TABLE github_issues_comments_local on cluster `cluster` UPDATE user__type=splitByString('/users/',user__received_events_url)[2] where 1=1
----------------------------------------------------------------------------------------
-- 删除分布式表&本地表所有数据 提示：
--  truncate table activities_local on cluster replicated
----------------------------------------------------------------------------------------

create table activities on cluster replicated
(
    owner              String,
    repo               String,
    github_id          Int64,
    github_login       String,
    knowledge_sharing  Float64,
    code_contribution  Float64,
    issue_coordination Float64,
    progress_control   Float64,
    code_tweaking      Float64,
    issue_reporting    Float64
)
    engine = Distributed('replicated', 'default', 'activities_local', github_id);

create table activities_local on cluster replicated
(
    owner              String,
    repo               String,
    github_id          Int64,
    github_login       String,
    knowledge_sharing  Float64,
    code_contribution  Float64,
    issue_coordination Float64,
    progress_control   Float64,
    code_tweaking      Float64,
    issue_reporting    Float64
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/activities', '{replica}')
        PARTITION BY owner
        ORDER BY (owner, repo, github_id)
        SETTINGS index_granularity = 8192;

create table activitys on cluster replicated
(
    owner              String,
    repo               String,
    github_id          Int64,
    github_login       String,
    knowledge_sharing  Float64,
    code_contribution  Float64,
    issue_coordination Float64,
    progress_control   Float64,
    code_tweaking      Float64,
    issue_reporting    Float64
)
    engine = Distributed('replicated', 'default', 'activitys_local', github_id);

create table activitys_local on cluster replicated
(
    owner              String,
    repo               String,
    github_id          Int64,
    github_login       String,
    knowledge_sharing  Float64,
    code_contribution  Float64,
    issue_coordination Float64,
    progress_control   Float64,
    code_tweaking      Float64,
    issue_reporting    Float64
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/activitys', '{replica}')
        PARTITION BY owner
        ORDER BY (owner, repo, github_id)
        SETTINGS index_granularity = 8192;

create table email_address on cluster replicated
(
    search_key__updated_at                                               Int64,
    search_key__email                                                    String,
    email                                                                String,
    email_aliase                                                         String,
    country_inferred_from_emailcctld                                     String,
    country_inferred_from_emaildomain                                    String,
    company_inferred_from_email                                          String,
    country_inferred_from_company                                        String,
    github__profile__login                                               String,
    github__profile__id                                                  Int64,
    github__profile__node_id                                             String,
    github__profile__avatardefault_url                                   String,
    github__profile__gravatar_id                                         String,
    github__profile__url                                                 String,
    github__profile__html_url                                            String,
    github__profile__followers_url                                       String,
    github__profile__following_url                                       String,
    github__profile__gists_url                                           String,
    github__profile__starred_url                                         String,
    github__profile__subscriptions_url                                   String,
    github__profile__organizations_url                                   String,
    github__profile__repos_url                                           String,
    github__profile__events_url                                          String,
    github__profile__received_events_url                                 String,
    github__profile__type                                                String,
    github__profile__site_admin                                          Int64,
    github__profile__name                                                String,
    github__profile__company                                             String,
    github__profile__blog                                                String,
    github__profile__location                                            String,
    github__profile__email                                               String,
    github__profile__hireable                                            Int64,
    github__profile__bio                                                 String,
    github__profile__twitter_username                                    String,
    github__profile__public_repos                                        Int64,
    github__profile__public_gists                                        Int64,
    github__profile__followers                                           Int64,
    github__profile__following                                           Int64,
    github__profile__created_at                                          DateTime64(3),
    github__profile__updated_at                                          DateTime64(3),
    github__profile__country_inferred_from_email_cctld                   String,
    github__profile__country_inferred_from_email_domain_company          String,
    github__profile__country_inferred_from_location                      String,
    github__profile__country_inferred_from_company                       String,
    github__profile__final_company_inferred_from_company                 String,
    github__profile__company_inferred_from_email_domain_company          String,
    github__profile__inferred_from_location__administrative_area_level_1 String,
    github__profile__inferred_from_location__administrative_area_level_2 String,
    github__profile__inferred_from_location__administrative_area_level_3 String,
    github__profile__inferred_from_location__colloquial_area             String,
    github__profile__inferred_from_location__continent                   String,
    github__profile__inferred_from_location__country                     String,
    github__profile__inferred_from_location__locality                    String,
    github__profile__inferred_from_location__political                   String,
    github__profile__inferred_from_location__postal_code                 String,
    github__profile__inferred_from_location__postal_code_suffix          String,
    github__profile__inferred_from_location__postal_town                 String,
    github__profile__inferred_from_location__route                       String,
    github__profile__inferred_from_location__street_number               String
)
    engine = Distributed('replicated', 'default', 'email_address_local', search_key__updated_at);

create table email_address_local on cluster replicated
(
    search_key__updated_at                                               Int64,
    search_key__email                                                    String,
    email                                                                String,
    email_aliase                                                         String,
    country_inferred_from_emailcctld                                     String,
    country_inferred_from_emaildomain                                    String,
    company_inferred_from_email                                          String,
    country_inferred_from_company                                        String,
    github__profile__login                                               String,
    github__profile__id                                                  Int64,
    github__profile__node_id                                             String,
    github__profile__avatardefault_url                                   String,
    github__profile__gravatar_id                                         String,
    github__profile__url                                                 String,
    github__profile__html_url                                            String,
    github__profile__followers_url                                       String,
    github__profile__following_url                                       String,
    github__profile__gists_url                                           String,
    github__profile__starred_url                                         String,
    github__profile__subscriptions_url                                   String,
    github__profile__organizations_url                                   String,
    github__profile__repos_url                                           String,
    github__profile__events_url                                          String,
    github__profile__received_events_url                                 String,
    github__profile__type                                                String,
    github__profile__site_admin                                          Int64,
    github__profile__name                                                String,
    github__profile__company                                             String,
    github__profile__blog                                                String,
    github__profile__location                                            String,
    github__profile__email                                               String,
    github__profile__hireable                                            Int64,
    github__profile__bio                                                 String,
    github__profile__twitter_username                                    String,
    github__profile__public_repos                                        Int64,
    github__profile__public_gists                                        Int64,
    github__profile__followers                                           Int64,
    github__profile__following                                           Int64,
    github__profile__created_at                                          DateTime64(3),
    github__profile__updated_at                                          DateTime64(3),
    github__profile__country_inferred_from_email_cctld                   String,
    github__profile__country_inferred_from_email_domain_company          String,
    github__profile__country_inferred_from_location                      String,
    github__profile__country_inferred_from_company                       String,
    github__profile__final_company_inferred_from_company                 String,
    github__profile__company_inferred_from_email_domain_company          String,
    github__profile__inferred_from_location__administrative_area_level_1 String,
    github__profile__inferred_from_location__administrative_area_level_2 String,
    github__profile__inferred_from_location__administrative_area_level_3 String,
    github__profile__inferred_from_location__colloquial_area             String,
    github__profile__inferred_from_location__continent                   String,
    github__profile__inferred_from_location__country                     String,
    github__profile__inferred_from_location__locality                    String,
    github__profile__inferred_from_location__political                   String,
    github__profile__inferred_from_location__postal_code                 String,
    github__profile__inferred_from_location__postal_code_suffix          String,
    github__profile__inferred_from_location__postal_town                 String,
    github__profile__inferred_from_location__route                       String,
    github__profile__inferred_from_location__street_number               String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/email_address', '{replica}')
        ORDER BY (search_key__updated_at, search_key__email)
        SETTINGS index_granularity = 8192;

create table email_domain_to_company_country on cluster replicated
(
    email_domain String,
    company      String,
    country      String
)
    engine = Distributed('replicated', 'default', 'email_domain_to_company_country_local', sipHash64(email_domain));

create table email_domain_to_company_country_local on cluster replicated
(
    email_domain String,
    company      String,
    country      String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/email_domain_to_company_country', '{replica}')
        PARTITION BY email_domain
        ORDER BY email_domain
        SETTINGS index_granularity = 8192;

create table github_commits on cluster replicated
(
    search_key__owner               String,
    search_key__repo                String,
    search_key__updated_at          Int64,
    sha                             String,
    node_id                         String,
    commit__author__name            String,
    commit__author__email           String,
    commit__author__date            String,
    commit__committer__name         String,
    commit__committer__email        String,
    commit__committer__date         String,
    commit__message                 String,
    commit__tree__sha               String,
    commit__tree__url               String,
    commit__url                     String,
    commit__comment_count           Int64,
    commit__verification__verified  Int64,
    commit__verification__reason    String,
    commit__verification__signature String,
    commit__verification__payload   String,
    url                             String,
    html_url                        String,
    comments_url                    String,
    author__login                   String,
    author__id                      Int64,
    author__node_id                 String,
    author__avatar_url              String,
    author__gravatar_id             String,
    author__url                     String,
    author__html_url                String,
    author__followers_url           String,
    author__following_url           String,
    author__gists_url               String,
    author__starred_url             String,
    author__subscriptions_url       String,
    author__organizations_url       String,
    author__repos_url               String,
    author__events_url              String,
    author__received_events_url     String,
    author__type                    String,
    author__site_admin              Int64,
    committer__login                String,
    committer__id                   Int64,
    committer__node_id              String,
    committer__avatar_url           String,
    committer__gravatar_id          String,
    committer__url                  String,
    committer__html_url             String,
    committer__followers_url        String,
    committer__following_url        String,
    committer__gists_url            String,
    committer__starred_url          String,
    committer__subscriptions_url    String,
    committer__organizations_url    String,
    committer__repos_url            String,
    committer__events_url           String,
    committer__received_events_url  String,
    committer__type                 String,
    committer__site_admin           Int64,
    `parents.sha`                   Array(String),
    `parents.url`                   Array(String),
    `parents.html_url`              Array(String)
)
    engine = Distributed('replicated', 'default', 'github_commits_local', search_key__updated_at);

create table github_commits_local on cluster replicated
(
    search_key__owner               String,
    search_key__repo                String,
    search_key__updated_at          Int64,
    sha                             String,
    node_id                         String,
    commit__author__name            String,
    commit__author__email           String,
    commit__author__date            String,
    commit__committer__name         String,
    commit__committer__email        String,
    commit__committer__date         String,
    commit__message                 String,
    commit__tree__sha               String,
    commit__tree__url               String,
    commit__url                     String,
    commit__comment_count           Int64,
    commit__verification__verified  Int64,
    commit__verification__reason    String,
    commit__verification__signature String,
    commit__verification__payload   String,
    url                             String,
    html_url                        String,
    comments_url                    String,
    author__login                   String,
    author__id                      Int64,
    author__node_id                 String,
    author__avatar_url              String,
    author__gravatar_id             String,
    author__url                     String,
    author__html_url                String,
    author__followers_url           String,
    author__following_url           String,
    author__gists_url               String,
    author__starred_url             String,
    author__subscriptions_url       String,
    author__organizations_url       String,
    author__repos_url               String,
    author__events_url              String,
    author__received_events_url     String,
    author__type                    String,
    author__site_admin              Int64,
    committer__login                String,
    committer__id                   Int64,
    committer__node_id              String,
    committer__avatar_url           String,
    committer__gravatar_id          String,
    committer__url                  String,
    committer__html_url             String,
    committer__followers_url        String,
    committer__following_url        String,
    committer__gists_url            String,
    committer__starred_url          String,
    committer__subscriptions_url    String,
    committer__organizations_url    String,
    committer__repos_url            String,
    committer__events_url           String,
    committer__received_events_url  String,
    committer__type                 String,
    committer__site_admin           Int64,
    `parents.sha`                   Array(String),
    `parents.url`                   Array(String),
    `parents.html_url`              Array(String)
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_commits', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo)
        SETTINGS index_granularity = 8192;

create table github_issues on cluster replicated
(
    search_key__owner                       String,
    search_key__repo                        String,
    search_key__updated_at                  Int64,
    url                                     String,
    repository_url                          String,
    labels_url                              String,
    comments_url                            String,
    events_url                              String,
    html_url                                String,
    id                                      Int64,
    node_id                                 String,
    number                                  Int64,
    title                                   String,
    user__login                             String,
    user__id                                Int64,
    user__node_id                           String,
    user__avatar_url                        String,
    user__gravatar_id                       String,
    user__url                               String,
    user__html_url                          String,
    user__followers_url                     String,
    user__following_url                     String,
    user__gists_url                         String,
    user__starred_url                       String,
    user__subscriptions_url                 String,
    user__organizations_url                 String,
    user__repos_url                         String,
    user__events_url                        String,
    user__received_events_url               String,
    user__type                              String,
    user__site_admin                        Int64,
    `labels.id`                             Array(Int64),
    `labels.node_id`                        Array(String),
    `labels.url`                            Array(String),
    `labels.name`                           Array(String),
    `labels.color`                          Array(String),
    `labels.default`                        Array(Int64),
    `labels.description`                    Array(String),
    state                                   String,
    locked                                  Int64,
    assignee__login                         String,
    assignee__id                            Int64,
    assignee__node_id                       String,
    assignee__avatar_url                    String,
    assignee__gravatar_id                   String,
    assignee__url                           String,
    assignee__html_url                      String,
    assignee__followers_url                 String,
    assignee__following_url                 String,
    assignee__gists_url                     String,
    assignee__starred_url                   String,
    assignee__subscriptions_url             String,
    assignee__organizations_url             String,
    assignee__repos_url                     String,
    assignee__events_url                    String,
    assignee__received_events_url           String,
    assignee__type                          String,
    assignee__site_admin                    Int64,
    `assignees.login`                       Array(String),
    `assignees.id`                          Array(Int64),
    `assignees.node_id`                     Array(String),
    `assignees.avatar_url`                  Array(String),
    `assignees.gravatar_id`                 Array(String),
    `assignees.url`                         Array(String),
    `assignees.html_url`                    Array(String),
    `assignees.followers_url`               Array(String),
    `assignees.following_url`               Array(String),
    `assignees.gists_url`                   Array(String),
    `assignees.starred_url`                 Array(String),
    `assignees.subscriptions_url`           Array(String),
    `assignees.organizations_url`           Array(String),
    `assignees.repos_url`                   Array(String),
    `assignees.events_url`                  Array(String),
    `assignees.received_events_url`         Array(String),
    `assignees.type`                        Array(String),
    `assignees.site_admin`                  Array(Int64),
    milestone__url                          String,
    milestone__html_url                     String,
    milestone__labels_url                   String,
    milestone__id                           Int64,
    milestone__node_id                      String,
    milestone__number                       Int64,
    milestone__state                        String,
    milestone__title                        String,
    milestone__description                  String,
    milestone__creator__login               String,
    milestone__creator__id                  Int64,
    milestone__creator__node_id             String,
    milestone__creator__avatar_url          String,
    milestone__creator__gravatar_id         String,
    milestone__creator__url                 String,
    milestone__creator__html_url            String,
    milestone__creator__followers_url       String,
    milestone__creator__following_url       String,
    milestone__creator__gists_url           String,
    milestone__creator__starred_url         String,
    milestone__creator__subscriptions_url   String,
    milestone__creator__organizations_url   String,
    milestone__creator__repos_url           String,
    milestone__creator__events_url          String,
    milestone__creator__received_events_url String,
    milestone__creator__type                String,
    milestone__creator__site_admin          Int64,
    milestone__open_issues                  Int64,
    milestone__closed_issues                Int64,
    milestone__created_at                   String,
    milestone__updated_at                   String,
    milestone__closed_at                    String,
    milestone__due_on                       String,
    comments                                Int64,
    created_at                              String,
    updated_at                              String,
    closed_at                               String,
    author_association                      String,
    active_lock_reason                      String,
    draft                                   Int64,
    pull_request__url                       String,
    pull_request__html_url                  String,
    pull_request__diff_url                  String,
    pull_request__patch_url                 String,
    pull_request__merged_at                 String,
    body                                    String,
    reactions__url                          String,
    reactions__total_count                  Int64,
    `reactions__+1`                         Int64,
    `reactions__-1`                         Int64,
    reactions__laugh                        Int64,
    reactions__hooray                       Int64,
    reactions__confused                     Int64,
    reactions__heart                        Int64,
    reactions__rocket                       Int64,
    reactions__eyes                         Int64,
    timeline_url                            String,
    performed_via_github_app                String
)
    engine = Distributed('replicated', 'default', 'github_issues_local', search_key__updated_at);

create table github_issues_comments on cluster replicated
(
    search_key__owner         String,
    search_key__repo          String,
    search_key__number        Int64,
    search_key__updated_at    Int64,
    url                       String,
    html_url                  String,
    issue_url                 String,
    id                        Int64,
    node_id                   String,
    user__login               String,
    user__id                  Int64,
    user__node_id             String,
    user__avatar_url          String,
    user__gravatar_id         String,
    user__url                 String,
    user__html_url            String,
    user__followers_url       String,
    user__following_url       String,
    user__gists_url           String,
    user__starred_url         String,
    user__subscriptions_url   String,
    user__organizations_url   String,
    user__repos_url           String,
    user__events_url          String,
    user__received_events_url String,
    user__type                String,
    user__site_admin          Int64,
    created_at                String,
    updated_at                String,
    author_association        String,
    body                      String,
    reactions__url            String,
    reactions__total_count    Int64,
    `reactions__+1`           Int64,
    `reactions__-1`           Int64,
    reactions__laugh          Int64,
    reactions__hooray         Int64,
    reactions__confused       Int64,
    reactions__heart          Int64,
    reactions__rocket         Int64,
    reactions__eyes           Int64,
    performed_via_github_app  String
)
    engine = Distributed('replicated', 'default', 'github_issues_comments_local', search_key__updated_at);

create table github_issues_comments_local on cluster replicated
(
    search_key__owner         String,
    search_key__repo          String,
    search_key__number        Int64,
    search_key__updated_at    Int64,
    url                       String,
    html_url                  String,
    issue_url                 String,
    id                        Int64,
    node_id                   String,
    user__login               String,
    user__id                  Int64,
    user__node_id             String,
    user__avatar_url          String,
    user__gravatar_id         String,
    user__url                 String,
    user__html_url            String,
    user__followers_url       String,
    user__following_url       String,
    user__gists_url           String,
    user__starred_url         String,
    user__subscriptions_url   String,
    user__organizations_url   String,
    user__repos_url           String,
    user__events_url          String,
    user__received_events_url String,
    user__type                String,
    user__site_admin          Int64,
    created_at                String,
    updated_at                String,
    author_association        String,
    body                      String,
    reactions__url            String,
    reactions__total_count    Int64,
    `reactions__+1`           Int64,
    `reactions__-1`           Int64,
    reactions__laugh          Int64,
    reactions__hooray         Int64,
    reactions__confused       Int64,
    reactions__heart          Int64,
    reactions__rocket         Int64,
    reactions__eyes           Int64,
    performed_via_github_app  String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_issues_comments', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo, search_key__number)
        SETTINGS index_granularity = 8192;

create table github_issues_local on cluster replicated
(
    search_key__owner                       String,
    search_key__repo                        String,
    search_key__updated_at                  Int64,
    url                                     String,
    repository_url                          String,
    labels_url                              String,
    comments_url                            String,
    events_url                              String,
    html_url                                String,
    id                                      Int64,
    node_id                                 String,
    number                                  Int64,
    title                                   String,
    user__login                             String,
    user__id                                Int64,
    user__node_id                           String,
    user__avatar_url                        String,
    user__gravatar_id                       String,
    user__url                               String,
    user__html_url                          String,
    user__followers_url                     String,
    user__following_url                     String,
    user__gists_url                         String,
    user__starred_url                       String,
    user__subscriptions_url                 String,
    user__organizations_url                 String,
    user__repos_url                         String,
    user__events_url                        String,
    user__received_events_url               String,
    user__type                              String,
    user__site_admin                        Int64,
    `labels.id`                             Array(Int64),
    `labels.node_id`                        Array(String),
    `labels.url`                            Array(String),
    `labels.name`                           Array(String),
    `labels.color`                          Array(String),
    `labels.default`                        Array(Int64),
    `labels.description`                    Array(String),
    state                                   String,
    locked                                  Int64,
    assignee__login                         String,
    assignee__id                            Int64,
    assignee__node_id                       String,
    assignee__avatar_url                    String,
    assignee__gravatar_id                   String,
    assignee__url                           String,
    assignee__html_url                      String,
    assignee__followers_url                 String,
    assignee__following_url                 String,
    assignee__gists_url                     String,
    assignee__starred_url                   String,
    assignee__subscriptions_url             String,
    assignee__organizations_url             String,
    assignee__repos_url                     String,
    assignee__events_url                    String,
    assignee__received_events_url           String,
    assignee__type                          String,
    assignee__site_admin                    Int64,
    `assignees.login`                       Array(String),
    `assignees.id`                          Array(Int64),
    `assignees.node_id`                     Array(String),
    `assignees.avatar_url`                  Array(String),
    `assignees.gravatar_id`                 Array(String),
    `assignees.url`                         Array(String),
    `assignees.html_url`                    Array(String),
    `assignees.followers_url`               Array(String),
    `assignees.following_url`               Array(String),
    `assignees.gists_url`                   Array(String),
    `assignees.starred_url`                 Array(String),
    `assignees.subscriptions_url`           Array(String),
    `assignees.organizations_url`           Array(String),
    `assignees.repos_url`                   Array(String),
    `assignees.events_url`                  Array(String),
    `assignees.received_events_url`         Array(String),
    `assignees.type`                        Array(String),
    `assignees.site_admin`                  Array(Int64),
    milestone__url                          String,
    milestone__html_url                     String,
    milestone__labels_url                   String,
    milestone__id                           Int64,
    milestone__node_id                      String,
    milestone__number                       Int64,
    milestone__state                        String,
    milestone__title                        String,
    milestone__description                  String,
    milestone__creator__login               String,
    milestone__creator__id                  Int64,
    milestone__creator__node_id             String,
    milestone__creator__avatar_url          String,
    milestone__creator__gravatar_id         String,
    milestone__creator__url                 String,
    milestone__creator__html_url            String,
    milestone__creator__followers_url       String,
    milestone__creator__following_url       String,
    milestone__creator__gists_url           String,
    milestone__creator__starred_url         String,
    milestone__creator__subscriptions_url   String,
    milestone__creator__organizations_url   String,
    milestone__creator__repos_url           String,
    milestone__creator__events_url          String,
    milestone__creator__received_events_url String,
    milestone__creator__type                String,
    milestone__creator__site_admin          Int64,
    milestone__open_issues                  Int64,
    milestone__closed_issues                Int64,
    milestone__created_at                   String,
    milestone__updated_at                   String,
    milestone__closed_at                    String,
    milestone__due_on                       String,
    comments                                Int64,
    created_at                              String,
    updated_at                              String,
    closed_at                               String,
    author_association                      String,
    active_lock_reason                      String,
    draft                                   Int64,
    pull_request__url                       String,
    pull_request__html_url                  String,
    pull_request__diff_url                  String,
    pull_request__patch_url                 String,
    pull_request__merged_at                 String,
    body                                    String,
    reactions__url                          String,
    reactions__total_count                  Int64,
    `reactions__+1`                         Int64,
    `reactions__-1`                         Int64,
    reactions__laugh                        Int64,
    reactions__hooray                       Int64,
    reactions__confused                     Int64,
    reactions__heart                        Int64,
    reactions__rocket                       Int64,
    reactions__eyes                         Int64,
    timeline_url                            String,
    performed_via_github_app                String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_issues', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo)
        SETTINGS index_granularity = 8192;

create table github_issues_timeline on cluster replicated
(
    search_key__owner      String,
    search_key__repo       String,
    search_key__number     Int64,
    search_key__updated_at Int64,
    timeline_raw           String
)
    engine = Distributed('replicated', 'default', 'github_issues_timeline_local', search_key__updated_at);

create table github_issues_timeline_local on cluster replicated
(
    search_key__owner      String,
    search_key__repo       String,
    search_key__number     Int64,
    search_key__updated_at Int64,
    timeline_raw           String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_issues_timeline', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo, search_key__number)
        SETTINGS index_granularity = 8192;

drop table github_profile on cluster replicated;
drop table github_profile_local on cluster replicated;

-- 删除 zookeeper 的 残留

create table github_profile on cluster replicated
(
    search_key__updated_at                              Int64,
    login                                               String,
    id                                                  Int64,
    node_id                                             String,
    avatar_url                                          String,
    gravatar_id                                         String,
    url                                                 String,
    html_url                                            String,
    followers_url                                       String,
    following_url                                       String,
    gists_url                                           String,
    starred_url                                         String,
    subscriptions_url                                   String,
    organizations_url                                   String,
    repos_url                                           String,
    events_url                                          String,
    received_events_url                                 String,
    type                                                String,
    site_admin                                          Int64,
    name                                                String,
    company                                             String,
    blog                                                String,
    location                                            String,
    email                                               String,
    hireable                                            Int64,
    bio                                                 String,
    twitter_username                                    String,
    public_repos                                        Int64,
    public_gists                                        Int64,
    followers                                           Int64,
    following                                           Int64,
    created_at                                          DateTime64(3),
    updated_at                                          DateTime64(3),
    country_inferred_from_email_cctld                   String,
    country_inferred_from_email_domain_company          String,
    country_inferred_from_location                      String,
    country_inferred_from_company                       String,
    final_company_inferred_from_company                 String,
    company_inferred_from_email_domain_company          String,
    inferred_from_location__administrative_area_level_1 String,
    inferred_from_location__administrative_area_level_2 String,
    inferred_from_location__administrative_area_level_3 String,
    inferred_from_location__colloquial_area             String,
    inferred_from_location__continent                   String,
    inferred_from_location__country                     String,
    inferred_from_location__locality                    String,
    inferred_from_location__political                   String,
    inferred_from_location__postal_code                 String,
    inferred_from_location__postal_code_suffix          String,
    inferred_from_location__postal_town                 String,
    inferred_from_location__route                       String,
    inferred_from_location__street_number               String,
    email_full_name                                     String,
    email_account                                       String,
    email_domain                                        String
)
    engine = Distributed('replicated', 'default', 'github_profile_local', search_key__updated_at);

create table github_profile_local on cluster replicated
(
    search_key__updated_at                              Int64,
    login                                               String,
    id                                                  Int64,
    node_id                                             String,
    avatar_url                                          String,
    gravatar_id                                         String,
    url                                                 String,
    html_url                                            String,
    followers_url                                       String,
    following_url                                       String,
    gists_url                                           String,
    starred_url                                         String,
    subscriptions_url                                   String,
    organizations_url                                   String,
    repos_url                                           String,
    events_url                                          String,
    received_events_url                                 String,
    type                                                String,
    site_admin                                          Int64,
    name                                                String,
    company                                             String,
    blog                                                String,
    location                                            String,
    email                                               String,
    hireable                                            Int64,
    bio                                                 String,
    twitter_username                                    String,
    public_repos                                        Int64,
    public_gists                                        Int64,
    followers                                           Int64,
    following                                           Int64,
    created_at                                          DateTime64(3),
    updated_at                                          DateTime64(3),
    country_inferred_from_email_cctld                   String,
    country_inferred_from_email_domain_company          String,
    country_inferred_from_location                      String,
    country_inferred_from_company                       String,
    final_company_inferred_from_company                 String,
    company_inferred_from_email_domain_company          String,
    inferred_from_location__administrative_area_level_1 String,
    inferred_from_location__administrative_area_level_2 String,
    inferred_from_location__administrative_area_level_3 String,
    inferred_from_location__colloquial_area             String,
    inferred_from_location__continent                   String,
    inferred_from_location__country                     String,
    inferred_from_location__locality                    String,
    inferred_from_location__political                   String,
    inferred_from_location__postal_code                 String,
    inferred_from_location__postal_code_suffix          String,
    inferred_from_location__postal_town                 String,
    inferred_from_location__route                       String,
    inferred_from_location__street_number               String,
    email_full_name                                     String,
    email_account                                       String,
    email_domain                                        String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_profile', '{replica}')
        ORDER BY search_key__updated_at
        SETTINGS index_granularity = 8192;

-- 数据同步 ck_sync_data_to_local.sql

create table github_pull_requests on cluster replicated
(
    search_key__owner                         String,
    search_key__repo                          String,
    search_key__updated_at                    Int64,
    url                                       String,
    id                                        Int64,
    node_id                                   String,
    html_url                                  String,
    diff_url                                  String,
    patch_url                                 String,
    issue_url                                 String,
    number                                    Int64,
    state                                     String,
    locked                                    Int64,
    title                                     String,
    user__login                               String,
    user__id                                  Int64,
    user__node_id                             String,
    user__avatar_url                          String,
    user__gravatar_id                         String,
    user__url                                 String,
    user__html_url                            String,
    user__followers_url                       String,
    user__following_url                       String,
    user__gists_url                           String,
    user__starred_url                         String,
    user__subscriptions_url                   String,
    user__organizations_url                   String,
    user__repos_url                           String,
    user__events_url                          String,
    user__received_events_url                 String,
    user__type                                String,
    user__site_admin                          Int64,
    body                                      String,
    created_at                                String,
    updated_at                                String,
    closed_at                                 String,
    merged_at                                 String,
    merge_commit_sha                          String,
    assignee__login                           String,
    assignee__id                              Int64,
    assignee__node_id                         String,
    assignee__avatar_url                      String,
    assignee__gravatar_id                     String,
    assignee__url                             String,
    assignee__html_url                        String,
    assignee__followers_url                   String,
    assignee__following_url                   String,
    assignee__gists_url                       String,
    assignee__starred_url                     String,
    assignee__subscriptions_url               String,
    assignee__organizations_url               String,
    assignee__repos_url                       String,
    assignee__events_url                      String,
    assignee__received_events_url             String,
    assignee__type                            String,
    assignee__site_admin                      Int64,
    `assignees.login`                         Array(String),
    `assignees.id`                            Array(Int64),
    `assignees.node_id`                       Array(String),
    `assignees.avatar_url`                    Array(String),
    `assignees.gravatar_id`                   Array(String),
    `assignees.url`                           Array(String),
    `assignees.html_url`                      Array(String),
    `assignees.followers_url`                 Array(String),
    `assignees.following_url`                 Array(String),
    `assignees.gists_url`                     Array(String),
    `assignees.starred_url`                   Array(String),
    `assignees.subscriptions_url`             Array(String),
    `assignees.organizations_url`             Array(String),
    `assignees.repos_url`                     Array(String),
    `assignees.events_url`                    Array(String),
    `assignees.received_events_url`           Array(String),
    `assignees.type`                          Array(String),
    `assignees.site_admin`                    Array(Int64),
    `requested_reviewers.login`               Array(String),
    `requested_reviewers.id`                  Array(Int64),
    `requested_reviewers.node_id`             Array(String),
    `requested_reviewers.avatar_url`          Array(String),
    `requested_reviewers.gravatar_id`         Array(String),
    `requested_reviewers.url`                 Array(String),
    `requested_reviewers.html_url`            Array(String),
    `requested_reviewers.followers_url`       Array(String),
    `requested_reviewers.following_url`       Array(String),
    `requested_reviewers.gists_url`           Array(String),
    `requested_reviewers.starred_url`         Array(String),
    `requested_reviewers.subscriptions_url`   Array(String),
    `requested_reviewers.organizations_url`   Array(String),
    `requested_reviewers.repos_url`           Array(String),
    `requested_reviewers.events_url`          Array(String),
    `requested_reviewers.received_events_url` Array(String),
    `requested_reviewers.type`                Array(String),
    `requested_reviewers.site_admin`          Array(Int64),
    `requested_teams.id`                      Array(Int64),
    `requested_teams.node_id`                 Array(String),
    `requested_teams.url`                     Array(String),
    `requested_teams.html_url`                Array(String),
    `requested_teams.name`                    Array(String),
    `requested_teams.slug`                    Array(String),
    `requested_teams.description`             Array(String),
    `requested_teams.privacy`                 Array(String),
    `requested_teams.permission`              Array(String),
    `requested_teams.members_url`             Array(String),
    `requested_teams.repositories_url`        Array(String),
    `requested_teams.parent`                  Array(Array(String)),
    `labels.id`                               Array(Int64),
    `labels.node_id`                          Array(String),
    `labels.url`                              Array(String),
    `labels.name`                             Array(String),
    `labels.color`                            Array(String),
    `labels.default`                          Array(Int64),
    `labels.description`                      Array(String),
    milestone__url                            String,
    milestone__html_url                       String,
    milestone__labels_url                     String,
    milestone__id                             Int64,
    milestone__node_id                        String,
    milestone__number                         Int64,
    milestone__state                          String,
    milestone__title                          String,
    milestone__description                    String,
    milestone__creator__login                 String,
    milestone__creator__id                    Int64,
    milestone__creator__node_id               String,
    milestone__creator__avatar_url            String,
    milestone__creator__gravatar_id           String,
    milestone__creator__url                   String,
    milestone__creator__html_url              String,
    milestone__creator__followers_url         String,
    milestone__creator__following_url         String,
    milestone__creator__gists_url             String,
    milestone__creator__starred_url           String,
    milestone__creator__subscriptions_url     String,
    milestone__creator__organizations_url     String,
    milestone__creator__repos_url             String,
    milestone__creator__events_url            String,
    milestone__creator__received_events_url   String,
    milestone__creator__type                  String,
    milestone__creator__site_admin            Int64,
    milestone__open_issues                    Int64,
    milestone__closed_issues                  Int64,
    milestone__created_at                     String,
    milestone__updated_at                     String,
    milestone__closed_at                      String,
    milestone__due_on                         String,
    draft                                     Int64,
    commits_url                               String,
    review_comments_url                       String,
    review_comment_url                        String,
    comments_url                              String,
    statuses_url                              String,
    head__label                               String,
    head__ref                                 String,
    head__sha                                 String,
    head__user__login                         String,
    head__user__id                            Int64,
    head__user__node_id                       String,
    head__user__avatar_url                    String,
    head__user__gravatar_id                   String,
    head__user__url                           String,
    head__user__html_url                      String,
    head__user__followers_url                 String,
    head__user__following_url                 String,
    head__user__gists_url                     String,
    head__user__starred_url                   String,
    head__user__subscriptions_url             String,
    head__user__organizations_url             String,
    head__user__repos_url                     String,
    head__user__events_url                    String,
    head__user__received_events_url           String,
    head__user__type                          String,
    head__user__site_admin                    Int64,
    head__repo__id                            Int64,
    head__repo__node_id                       String,
    head__repo__name                          String,
    head__repo__full_name                     String,
    head__repo__private                       Int64,
    head__repo__owner__login                  String,
    head__repo__owner__id                     Int64,
    head__repo__owner__node_id                String,
    head__repo__owner__avatar_url             String,
    head__repo__owner__gravatar_id            String,
    head__repo__owner__url                    String,
    head__repo__owner__html_url               String,
    head__repo__owner__followers_url          String,
    head__repo__owner__following_url          String,
    head__repo__owner__gists_url              String,
    head__repo__owner__starred_url            String,
    head__repo__owner__subscriptions_url      String,
    head__repo__owner__organizations_url      String,
    head__repo__owner__repos_url              String,
    head__repo__owner__events_url             String,
    head__repo__owner__received_events_url    String,
    head__repo__owner__type                   String,
    head__repo__owner__site_admin             Int64,
    head__repo__html_url                      String,
    head__repo__description                   String,
    head__repo__fork                          Int64,
    head__repo__url                           String,
    head__repo__forks_url                     String,
    head__repo__keys_url                      String,
    head__repo__collaborators_url             String,
    head__repo__teams_url                     String,
    head__repo__hooks_url                     String,
    head__repo__issue_events_url              String,
    head__repo__events_url                    String,
    head__repo__assignees_url                 String,
    head__repo__branches_url                  String,
    head__repo__tags_url                      String,
    head__repo__blobs_url                     String,
    head__repo__git_tags_url                  String,
    head__repo__git_refs_url                  String,
    head__repo__trees_url                     String,
    head__repo__statuses_url                  String,
    head__repo__languages_url                 String,
    head__repo__stargazers_url                String,
    head__repo__contributors_url              String,
    head__repo__subscribers_url               String,
    head__repo__subscription_url              String,
    head__repo__commits_url                   String,
    head__repo__git_commits_url               String,
    head__repo__comments_url                  String,
    head__repo__issue_comment_url             String,
    head__repo__contents_url                  String,
    head__repo__compare_url                   String,
    head__repo__merges_url                    String,
    head__repo__archive_url                   String,
    head__repo__downloads_url                 String,
    head__repo__issues_url                    String,
    head__repo__pulls_url                     String,
    head__repo__milestones_url                String,
    head__repo__notifications_url             String,
    head__repo__labels_url                    String,
    head__repo__releases_url                  String,
    head__repo__deployments_url               String,
    head__repo__created_at                    String,
    head__repo__updated_at                    String,
    head__repo__pushed_at                     String,
    head__repo__git_url                       String,
    head__repo__ssh_url                       String,
    head__repo__clone_url                     String,
    head__repo__svn_url                       String,
    head__repo__homepage                      String,
    head__repo__size                          Int64,
    head__repo__stargazers_count              Int64,
    head__repo__watchers_count                Int64,
    head__repo__language                      String,
    head__repo__has_issues                    Int64,
    head__repo__has_projects                  Int64,
    head__repo__has_downloads                 Int64,
    head__repo__has_wiki                      Int64,
    head__repo__has_pages                     Int64,
    head__repo__forks_count                   Int64,
    head__repo__mirror_url                    String,
    head__repo__archived                      Int64,
    head__repo__disabled                      Int64,
    head__repo__open_issues_count             Int64,
    head__repo__license__key                  String,
    head__repo__license__name                 String,
    head__repo__license__spdx_id              String,
    head__repo__license__url                  String,
    head__repo__license__node_id              String,
    head__repo__allow_forking                 Int64,
    head__repo__is_template                   Int64,
    head__repo__topics                        Array(String),
    head__repo__visibility                    String,
    head__repo__forks                         Int64,
    head__repo__open_issues                   Int64,
    head__repo__watchers                      Int64,
    head__repo__default_branch                String,
    base__label                               String,
    base__ref                                 String,
    base__sha                                 String,
    base__user__login                         String,
    base__user__id                            Int64,
    base__user__node_id                       String,
    base__user__avatar_url                    String,
    base__user__gravatar_id                   String,
    base__user__url                           String,
    base__user__html_url                      String,
    base__user__followers_url                 String,
    base__user__following_url                 String,
    base__user__gists_url                     String,
    base__user__starred_url                   String,
    base__user__subscriptions_url             String,
    base__user__organizations_url             String,
    base__user__repos_url                     String,
    base__user__events_url                    String,
    base__user__received_events_url           String,
    base__user__type                          String,
    base__user__site_admin                    Int64,
    base__repo__id                            Int64,
    base__repo__node_id                       String,
    base__repo__name                          String,
    base__repo__full_name                     String,
    base__repo__private                       Int64,
    base__repo__owner__login                  String,
    base__repo__owner__id                     Int64,
    base__repo__owner__node_id                String,
    base__repo__owner__avatar_url             String,
    base__repo__owner__gravatar_id            String,
    base__repo__owner__url                    String,
    base__repo__owner__html_url               String,
    base__repo__owner__followers_url          String,
    base__repo__owner__following_url          String,
    base__repo__owner__gists_url              String,
    base__repo__owner__starred_url            String,
    base__repo__owner__subscriptions_url      String,
    base__repo__owner__organizations_url      String,
    base__repo__owner__repos_url              String,
    base__repo__owner__events_url             String,
    base__repo__owner__received_events_url    String,
    base__repo__owner__type                   String,
    base__repo__owner__site_admin             Int64,
    base__repo__html_url                      String,
    base__repo__description                   String,
    base__repo__fork                          Int64,
    base__repo__url                           String,
    base__repo__forks_url                     String,
    base__repo__keys_url                      String,
    base__repo__collaborators_url             String,
    base__repo__teams_url                     String,
    base__repo__hooks_url                     String,
    base__repo__issue_events_url              String,
    base__repo__events_url                    String,
    base__repo__assignees_url                 String,
    base__repo__branches_url                  String,
    base__repo__tags_url                      String,
    base__repo__blobs_url                     String,
    base__repo__git_tags_url                  String,
    base__repo__git_refs_url                  String,
    base__repo__trees_url                     String,
    base__repo__statuses_url                  String,
    base__repo__languages_url                 String,
    base__repo__stargazers_url                String,
    base__repo__contributors_url              String,
    base__repo__subscribers_url               String,
    base__repo__subscription_url              String,
    base__repo__commits_url                   String,
    base__repo__git_commits_url               String,
    base__repo__comments_url                  String,
    base__repo__issue_comment_url             String,
    base__repo__contents_url                  String,
    base__repo__compare_url                   String,
    base__repo__merges_url                    String,
    base__repo__archive_url                   String,
    base__repo__downloads_url                 String,
    base__repo__issues_url                    String,
    base__repo__pulls_url                     String,
    base__repo__milestones_url                String,
    base__repo__notifications_url             String,
    base__repo__labels_url                    String,
    base__repo__releases_url                  String,
    base__repo__deployments_url               String,
    base__repo__created_at                    String,
    base__repo__updated_at                    String,
    base__repo__pushed_at                     String,
    base__repo__git_url                       String,
    base__repo__ssh_url                       String,
    base__repo__clone_url                     String,
    base__repo__svn_url                       String,
    base__repo__homepage                      String,
    base__repo__size                          Int64,
    base__repo__stargazers_count              Int64,
    base__repo__watchers_count                Int64,
    base__repo__language                      String,
    base__repo__has_issues                    Int64,
    base__repo__has_projects                  Int64,
    base__repo__has_downloads                 Int64,
    base__repo__has_wiki                      Int64,
    base__repo__has_pages                     Int64,
    base__repo__forks_count                   Int64,
    base__repo__mirror_url                    String,
    base__repo__archived                      Int64,
    base__repo__disabled                      Int64,
    base__repo__open_issues_count             Int64,
    base__repo__license__key                  String,
    base__repo__license__name                 String,
    base__repo__license__spdx_id              String,
    base__repo__license__url                  String,
    base__repo__license__node_id              String,
    base__repo__allow_forking                 Int64,
    base__repo__is_template                   Int64,
    base__repo__topics                        Array(String),
    base__repo__visibility                    String,
    base__repo__forks                         Int64,
    base__repo__open_issues                   Int64,
    base__repo__watchers                      Int64,
    base__repo__default_branch                String,
    _links__self__href                        String,
    _links__html__href                        String,
    _links__issue__href                       String,
    _links__comments__href                    String,
    _links__review_comments__href             String,
    _links__review_comment__href              String,
    _links__commits__href                     String,
    _links__statuses__href                    String,
    author_association                        String,
    auto_merge                                String,
    active_lock_reason                        String
)
    engine = Distributed('replicated', 'default', 'github_pull_requests_local', search_key__updated_at);

create table github_pull_requests_local on cluster replicated
(
    search_key__owner                         String,
    search_key__repo                          String,
    search_key__updated_at                    Int64,
    url                                       String,
    id                                        Int64,
    node_id                                   String,
    html_url                                  String,
    diff_url                                  String,
    patch_url                                 String,
    issue_url                                 String,
    number                                    Int64,
    state                                     String,
    locked                                    Int64,
    title                                     String,
    user__login                               String,
    user__id                                  Int64,
    user__node_id                             String,
    user__avatar_url                          String,
    user__gravatar_id                         String,
    user__url                                 String,
    user__html_url                            String,
    user__followers_url                       String,
    user__following_url                       String,
    user__gists_url                           String,
    user__starred_url                         String,
    user__subscriptions_url                   String,
    user__organizations_url                   String,
    user__repos_url                           String,
    user__events_url                          String,
    user__received_events_url                 String,
    user__type                                String,
    user__site_admin                          Int64,
    body                                      String,
    created_at                                String,
    updated_at                                String,
    closed_at                                 String,
    merged_at                                 String,
    merge_commit_sha                          String,
    assignee__login                           String,
    assignee__id                              Int64,
    assignee__node_id                         String,
    assignee__avatar_url                      String,
    assignee__gravatar_id                     String,
    assignee__url                             String,
    assignee__html_url                        String,
    assignee__followers_url                   String,
    assignee__following_url                   String,
    assignee__gists_url                       String,
    assignee__starred_url                     String,
    assignee__subscriptions_url               String,
    assignee__organizations_url               String,
    assignee__repos_url                       String,
    assignee__events_url                      String,
    assignee__received_events_url             String,
    assignee__type                            String,
    assignee__site_admin                      Int64,
    `assignees.login`                         Array(String),
    `assignees.id`                            Array(Int64),
    `assignees.node_id`                       Array(String),
    `assignees.avatar_url`                    Array(String),
    `assignees.gravatar_id`                   Array(String),
    `assignees.url`                           Array(String),
    `assignees.html_url`                      Array(String),
    `assignees.followers_url`                 Array(String),
    `assignees.following_url`                 Array(String),
    `assignees.gists_url`                     Array(String),
    `assignees.starred_url`                   Array(String),
    `assignees.subscriptions_url`             Array(String),
    `assignees.organizations_url`             Array(String),
    `assignees.repos_url`                     Array(String),
    `assignees.events_url`                    Array(String),
    `assignees.received_events_url`           Array(String),
    `assignees.type`                          Array(String),
    `assignees.site_admin`                    Array(Int64),
    `requested_reviewers.login`               Array(String),
    `requested_reviewers.id`                  Array(Int64),
    `requested_reviewers.node_id`             Array(String),
    `requested_reviewers.avatar_url`          Array(String),
    `requested_reviewers.gravatar_id`         Array(String),
    `requested_reviewers.url`                 Array(String),
    `requested_reviewers.html_url`            Array(String),
    `requested_reviewers.followers_url`       Array(String),
    `requested_reviewers.following_url`       Array(String),
    `requested_reviewers.gists_url`           Array(String),
    `requested_reviewers.starred_url`         Array(String),
    `requested_reviewers.subscriptions_url`   Array(String),
    `requested_reviewers.organizations_url`   Array(String),
    `requested_reviewers.repos_url`           Array(String),
    `requested_reviewers.events_url`          Array(String),
    `requested_reviewers.received_events_url` Array(String),
    `requested_reviewers.type`                Array(String),
    `requested_reviewers.site_admin`          Array(Int64),
    `requested_teams.id`                      Array(Int64),
    `requested_teams.node_id`                 Array(String),
    `requested_teams.url`                     Array(String),
    `requested_teams.html_url`                Array(String),
    `requested_teams.name`                    Array(String),
    `requested_teams.slug`                    Array(String),
    `requested_teams.description`             Array(String),
    `requested_teams.privacy`                 Array(String),
    `requested_teams.permission`              Array(String),
    `requested_teams.members_url`             Array(String),
    `requested_teams.repositories_url`        Array(String),
    `requested_teams.parent`                  Array(Array(String)),
    `labels.id`                               Array(Int64),
    `labels.node_id`                          Array(String),
    `labels.url`                              Array(String),
    `labels.name`                             Array(String),
    `labels.color`                            Array(String),
    `labels.default`                          Array(Int64),
    `labels.description`                      Array(String),
    milestone__url                            String,
    milestone__html_url                       String,
    milestone__labels_url                     String,
    milestone__id                             Int64,
    milestone__node_id                        String,
    milestone__number                         Int64,
    milestone__state                          String,
    milestone__title                          String,
    milestone__description                    String,
    milestone__creator__login                 String,
    milestone__creator__id                    Int64,
    milestone__creator__node_id               String,
    milestone__creator__avatar_url            String,
    milestone__creator__gravatar_id           String,
    milestone__creator__url                   String,
    milestone__creator__html_url              String,
    milestone__creator__followers_url         String,
    milestone__creator__following_url         String,
    milestone__creator__gists_url             String,
    milestone__creator__starred_url           String,
    milestone__creator__subscriptions_url     String,
    milestone__creator__organizations_url     String,
    milestone__creator__repos_url             String,
    milestone__creator__events_url            String,
    milestone__creator__received_events_url   String,
    milestone__creator__type                  String,
    milestone__creator__site_admin            Int64,
    milestone__open_issues                    Int64,
    milestone__closed_issues                  Int64,
    milestone__created_at                     String,
    milestone__updated_at                     String,
    milestone__closed_at                      String,
    milestone__due_on                         String,
    draft                                     Int64,
    commits_url                               String,
    review_comments_url                       String,
    review_comment_url                        String,
    comments_url                              String,
    statuses_url                              String,
    head__label                               String,
    head__ref                                 String,
    head__sha                                 String,
    head__user__login                         String,
    head__user__id                            Int64,
    head__user__node_id                       String,
    head__user__avatar_url                    String,
    head__user__gravatar_id                   String,
    head__user__url                           String,
    head__user__html_url                      String,
    head__user__followers_url                 String,
    head__user__following_url                 String,
    head__user__gists_url                     String,
    head__user__starred_url                   String,
    head__user__subscriptions_url             String,
    head__user__organizations_url             String,
    head__user__repos_url                     String,
    head__user__events_url                    String,
    head__user__received_events_url           String,
    head__user__type                          String,
    head__user__site_admin                    Int64,
    head__repo__id                            Int64,
    head__repo__node_id                       String,
    head__repo__name                          String,
    head__repo__full_name                     String,
    head__repo__private                       Int64,
    head__repo__owner__login                  String,
    head__repo__owner__id                     Int64,
    head__repo__owner__node_id                String,
    head__repo__owner__avatar_url             String,
    head__repo__owner__gravatar_id            String,
    head__repo__owner__url                    String,
    head__repo__owner__html_url               String,
    head__repo__owner__followers_url          String,
    head__repo__owner__following_url          String,
    head__repo__owner__gists_url              String,
    head__repo__owner__starred_url            String,
    head__repo__owner__subscriptions_url      String,
    head__repo__owner__organizations_url      String,
    head__repo__owner__repos_url              String,
    head__repo__owner__events_url             String,
    head__repo__owner__received_events_url    String,
    head__repo__owner__type                   String,
    head__repo__owner__site_admin             Int64,
    head__repo__html_url                      String,
    head__repo__description                   String,
    head__repo__fork                          Int64,
    head__repo__url                           String,
    head__repo__forks_url                     String,
    head__repo__keys_url                      String,
    head__repo__collaborators_url             String,
    head__repo__teams_url                     String,
    head__repo__hooks_url                     String,
    head__repo__issue_events_url              String,
    head__repo__events_url                    String,
    head__repo__assignees_url                 String,
    head__repo__branches_url                  String,
    head__repo__tags_url                      String,
    head__repo__blobs_url                     String,
    head__repo__git_tags_url                  String,
    head__repo__git_refs_url                  String,
    head__repo__trees_url                     String,
    head__repo__statuses_url                  String,
    head__repo__languages_url                 String,
    head__repo__stargazers_url                String,
    head__repo__contributors_url              String,
    head__repo__subscribers_url               String,
    head__repo__subscription_url              String,
    head__repo__commits_url                   String,
    head__repo__git_commits_url               String,
    head__repo__comments_url                  String,
    head__repo__issue_comment_url             String,
    head__repo__contents_url                  String,
    head__repo__compare_url                   String,
    head__repo__merges_url                    String,
    head__repo__archive_url                   String,
    head__repo__downloads_url                 String,
    head__repo__issues_url                    String,
    head__repo__pulls_url                     String,
    head__repo__milestones_url                String,
    head__repo__notifications_url             String,
    head__repo__labels_url                    String,
    head__repo__releases_url                  String,
    head__repo__deployments_url               String,
    head__repo__created_at                    String,
    head__repo__updated_at                    String,
    head__repo__pushed_at                     String,
    head__repo__git_url                       String,
    head__repo__ssh_url                       String,
    head__repo__clone_url                     String,
    head__repo__svn_url                       String,
    head__repo__homepage                      String,
    head__repo__size                          Int64,
    head__repo__stargazers_count              Int64,
    head__repo__watchers_count                Int64,
    head__repo__language                      String,
    head__repo__has_issues                    Int64,
    head__repo__has_projects                  Int64,
    head__repo__has_downloads                 Int64,
    head__repo__has_wiki                      Int64,
    head__repo__has_pages                     Int64,
    head__repo__forks_count                   Int64,
    head__repo__mirror_url                    String,
    head__repo__archived                      Int64,
    head__repo__disabled                      Int64,
    head__repo__open_issues_count             Int64,
    head__repo__license__key                  String,
    head__repo__license__name                 String,
    head__repo__license__spdx_id              String,
    head__repo__license__url                  String,
    head__repo__license__node_id              String,
    head__repo__allow_forking                 Int64,
    head__repo__is_template                   Int64,
    head__repo__topics                        Array(String),
    head__repo__visibility                    String,
    head__repo__forks                         Int64,
    head__repo__open_issues                   Int64,
    head__repo__watchers                      Int64,
    head__repo__default_branch                String,
    base__label                               String,
    base__ref                                 String,
    base__sha                                 String,
    base__user__login                         String,
    base__user__id                            Int64,
    base__user__node_id                       String,
    base__user__avatar_url                    String,
    base__user__gravatar_id                   String,
    base__user__url                           String,
    base__user__html_url                      String,
    base__user__followers_url                 String,
    base__user__following_url                 String,
    base__user__gists_url                     String,
    base__user__starred_url                   String,
    base__user__subscriptions_url             String,
    base__user__organizations_url             String,
    base__user__repos_url                     String,
    base__user__events_url                    String,
    base__user__received_events_url           String,
    base__user__type                          String,
    base__user__site_admin                    Int64,
    base__repo__id                            Int64,
    base__repo__node_id                       String,
    base__repo__name                          String,
    base__repo__full_name                     String,
    base__repo__private                       Int64,
    base__repo__owner__login                  String,
    base__repo__owner__id                     Int64,
    base__repo__owner__node_id                String,
    base__repo__owner__avatar_url             String,
    base__repo__owner__gravatar_id            String,
    base__repo__owner__url                    String,
    base__repo__owner__html_url               String,
    base__repo__owner__followers_url          String,
    base__repo__owner__following_url          String,
    base__repo__owner__gists_url              String,
    base__repo__owner__starred_url            String,
    base__repo__owner__subscriptions_url      String,
    base__repo__owner__organizations_url      String,
    base__repo__owner__repos_url              String,
    base__repo__owner__events_url             String,
    base__repo__owner__received_events_url    String,
    base__repo__owner__type                   String,
    base__repo__owner__site_admin             Int64,
    base__repo__html_url                      String,
    base__repo__description                   String,
    base__repo__fork                          Int64,
    base__repo__url                           String,
    base__repo__forks_url                     String,
    base__repo__keys_url                      String,
    base__repo__collaborators_url             String,
    base__repo__teams_url                     String,
    base__repo__hooks_url                     String,
    base__repo__issue_events_url              String,
    base__repo__events_url                    String,
    base__repo__assignees_url                 String,
    base__repo__branches_url                  String,
    base__repo__tags_url                      String,
    base__repo__blobs_url                     String,
    base__repo__git_tags_url                  String,
    base__repo__git_refs_url                  String,
    base__repo__trees_url                     String,
    base__repo__statuses_url                  String,
    base__repo__languages_url                 String,
    base__repo__stargazers_url                String,
    base__repo__contributors_url              String,
    base__repo__subscribers_url               String,
    base__repo__subscription_url              String,
    base__repo__commits_url                   String,
    base__repo__git_commits_url               String,
    base__repo__comments_url                  String,
    base__repo__issue_comment_url             String,
    base__repo__contents_url                  String,
    base__repo__compare_url                   String,
    base__repo__merges_url                    String,
    base__repo__archive_url                   String,
    base__repo__downloads_url                 String,
    base__repo__issues_url                    String,
    base__repo__pulls_url                     String,
    base__repo__milestones_url                String,
    base__repo__notifications_url             String,
    base__repo__labels_url                    String,
    base__repo__releases_url                  String,
    base__repo__deployments_url               String,
    base__repo__created_at                    String,
    base__repo__updated_at                    String,
    base__repo__pushed_at                     String,
    base__repo__git_url                       String,
    base__repo__ssh_url                       String,
    base__repo__clone_url                     String,
    base__repo__svn_url                       String,
    base__repo__homepage                      String,
    base__repo__size                          Int64,
    base__repo__stargazers_count              Int64,
    base__repo__watchers_count                Int64,
    base__repo__language                      String,
    base__repo__has_issues                    Int64,
    base__repo__has_projects                  Int64,
    base__repo__has_downloads                 Int64,
    base__repo__has_wiki                      Int64,
    base__repo__has_pages                     Int64,
    base__repo__forks_count                   Int64,
    base__repo__mirror_url                    String,
    base__repo__archived                      Int64,
    base__repo__disabled                      Int64,
    base__repo__open_issues_count             Int64,
    base__repo__license__key                  String,
    base__repo__license__name                 String,
    base__repo__license__spdx_id              String,
    base__repo__license__url                  String,
    base__repo__license__node_id              String,
    base__repo__allow_forking                 Int64,
    base__repo__is_template                   Int64,
    base__repo__topics                        Array(String),
    base__repo__visibility                    String,
    base__repo__forks                         Int64,
    base__repo__open_issues                   Int64,
    base__repo__watchers                      Int64,
    base__repo__default_branch                String,
    _links__self__href                        String,
    _links__html__href                        String,
    _links__issue__href                       String,
    _links__comments__href                    String,
    _links__review_comments__href             String,
    _links__review_comment__href              String,
    _links__commits__href                     String,
    _links__statuses__href                    String,
    author_association                        String,
    auto_merge                                String,
    active_lock_reason                        String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/github_pull_requests', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo)
        SETTINGS index_granularity = 8192;

create table github_tokens on cluster replicated
(
    account String,
    token   String,
    limit   UInt16,
    status  String
)
    engine = MergeTree PRIMARY KEY token
        ORDER BY token
        SETTINGS index_granularity = 8192;

create table gits on cluster replicated
(
    search_key__owner       String,
    search_key__repo        String,
    search_key__origin      String,
    search_key__updated_at  Int64,
    message                 String,
    hexsha                  String,
    parents                 Array(String),
    author_tz               Int64,
    committer_tz            Int64,
    author_name             String,
    author_email            String,
    committer_name          String,
    committer_email         String,
    authored_date           DateTime64(3),
    authored_timestamp      Int64,
    committed_date          DateTime64(3),
    committed_timestamp     Int64,
    `files.insertions`      Array(Int64),
    `files.deletions`       Array(Int64),
    `files.lines`           Array(Int64),
    `files.file_name`       Array(String),
    total__insertions       Int64,
    total__deletions        Int64,
    total__lines            Int64,
    total__files            Int64,
    if_merged               Int64,
    type                    String,
    author_email_account    String,
    author_email_domain     String,
    committer_email_account String,
    committer_email_domain  String
)
    engine = Distributed('replicated', 'default', 'gits_local', search_key__updated_at);

create table gits_local on cluster replicated
(
    search_key__owner       String,
    search_key__repo        String,
    search_key__origin      String,
    search_key__updated_at  Int64,
    message                 String,
    hexsha                  String,
    parents                 Array(String),
    author_tz               Int64,
    committer_tz            Int64,
    author_name             String,
    author_email            String,
    committer_name          String,
    committer_email         String,
    authored_date           DateTime64(3),
    authored_timestamp      Int64,
    committed_date          DateTime64(3),
    committed_timestamp     Int64,
    `files.insertions`      Array(Int64),
    `files.deletions`       Array(Int64),
    `files.lines`           Array(Int64),
    `files.file_name`       Array(String),
    total__insertions       Int64,
    total__deletions        Int64,
    total__lines            Int64,
    total__files            Int64,
    if_merged               Int64,
    type                    String,
    author_email_account    String,
    author_email_domain     String,
    committer_email_account String,
    committer_email_domain  String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/gits', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo, search_key__origin)
        SETTINGS index_granularity = 8192;

create table maillists on cluster replicated
(
    backend_name                                  String,
    backend_version                               String,
    perceval_version                              String,
    timestamp                                     Float64,
    origin                                        String,
    uuid                                          String,
    updated_on                                    Float64,
    classified_fields_filtered                    Array(Array(String)),
    category                                      String,
    tag                                           String,
    metadata__updated_on                          DateTime64(3),
    metadata__timestamp                           DateTime64(3),
    search_fields__item_id                        String,
    data__unixfrom                                String,
    data__From                                    String,
    data__Subject                                 String,
    `data__In-Reply-To`                           String,
    data__References                              String,
    data__body__plain                             String,
    `data__Message-ID`                            String,
    data__Date                                    DateTime64(3),
    data__Date_tz                                 Int64,
    data__Received                                String,
    `data__DKIM-Signature`                        String,
    `data__MIME-Version`                          String,
    data__To                                      String,
    data__Cc                                      String,
    `data__Content-Type`                          String,
    `data__Received-SPF`                          String,
    data__Precedence                              String,
    `data__List-Id`                               String,
    `data__List-Unsubscribe`                      String,
    `data__List-Archive`                          String,
    `data__List-Post`                             String,
    `data__List-Help`                             String,
    `data__List-Subscribe`                        String,
    `data__User-Agent`                            String,
    `data__Content-Transfer-Encoding`             String,
    `data__MIME-version`                          String,
    `data__Content-transfer-encoding`             String,
    `data__Content-type`                          String,
    `data__Content-Disposition`                   String,
    `data__Content-Language`                      String,
    `data__Reply-To`                              String,
    data__CC                                      String,
    `data__Thread-Index`                          String,
    `data__Mail-Followup-To`                      String,
    `data__Authentication-Results`                String,
    `data__Resent-From`                           String,
    `data__Resent-Date`                           String,
    `data__Resent-Message-ID`                     String,
    `data__Resent-To`                             String,
    data__Importance                              String,
    `data__IronPort-SDR`                          String,
    `data__Content-Length`                        String,
    `data__Content-ID`                            String,
    `data__Mime-Version`                          String,
    `data__ARC-Seal`                              String,
    `data__ARC-Message-Signature`                 String,
    `data__ARC-Authentication-Results`            String,
    `data__Thread-Topic`                          String,
    `data__Accept-Language`                       String,
    `data__authentication-results`                String,
    data__Bcc                                     String,
    `data__DomainKey-Signature`                   String,
    data__Autocrypt                               String,
    data__Organization                            String,
    data__suggested_attachment_session_id         String,
    `data__Original-Sender`                       String,
    `data__Resent-CC`                             String,
    `data__Resent-Sender`                         String,
    data__Sender                                  String,
    `data__Errors-To`                             String,
    data__acceptlanguage                          String,
    data__Lines                                   String,
    `data__Resent-Message-Id`                     String,
    data__Face                                    String,
    data__Copyright                               String,
    data__OpenPGP                                 String,
    `data__OpenPGP-Fingerprint`                   String,
    `data__Content-disposition`                   String,
    `data__In-reply-to`                           String,
    data__Emacs                                   String,
    `data__Content-language`                      String,
    `data__Mail-Copies-To`                        String,
    `data__thread-index`                          String,
    `data__Thread-topic`                          String,
    `data__Thread-index`                          String,
    `data__Content-class`                         String,
    `data__content-class`                         String,
    `data__Cancel-Lock`                           String,
    `data__Content-Class`                         String,
    data__Priority                                String,
    `data__Delivered-To`                          String,
    `data__Mime-version`                          String,
    `data__Full-Name`                             String,
    data__HC                                      String,
    `data__ReSent-Date`                           String,
    `data__ReSent-From`                           String,
    `data__ReSent-To`                             String,
    `data__ReSent-Subject`                        String,
    `data__ReSent-Message-ID`                     String,
    `data__ReSent-User-Agent`                     String,
    data__importance                              String,
    data__Comments                                String,
    data__xOriginalSenderIP                       String,
    `data__Ligue-dja`                             String,
    `data__mime-version`                          String,
    data__from                                    String,
    data__sender                                  String,
    data__to                                      String,
    `data__Message-Context`                       String,
    `data__Mail-followup-to`                      String,
    data__Openpgp                                 String,
    `data__dkim-signature`                        String,
    `data__Hebrew-Date`                           String,
    `data__user-agent`                            String,
    `data__received-spf`                          String,
    data__spamdiagnosticoutput                    String,
    data__spamdiagnosticmetadata                  String,
    `data__DMARC-Filter`                          String,
    `data__DKIM-Filter`                           String,
    `data__Feedback-ID`                           String,
    data__Sensitivity                             String,
    `data__IronPort-PHdr`                         String,
    data__amddisc                                 String,
    data__SpamDiagnosticOutput                    String,
    data__SpamDiagnosticMetadata                  String,
    `data__Envelope-From`                         String,
    `data__Content-description`                   String,
    data__bn1pr05mb937                            String,
    `data__Authentication-Result`                 String,
    `data__dlp-product`                           String,
    `data__dlp-version`                           String,
    `data__dlp-reaction`                          String,
    data__MTA                                     String,
    data__EDITOR                                  String,
    data__cc                                      String,
    `data__Read-Receipt-To`                       String,
    `data__Mail-Reply-To`                         String,
    `data__PGP-Key`                               String,
    `data__User-agent`                            String,
    data__X_CMAE_Category                         String,
    data__Accept                                  String,
    data__Path                                    String,
    data__Newsgroups                              String,
    `data__IronPort-HdrOrdr`                      String,
    data__Originator                              String,
    data__Author                                  String,
    data__BlahBlahBlah                            String,
    data__Expires                                 String,
    data__Outgoingd                               String,
    `data__Resent-User-Agent`                     String,
    `data__Date-MUA`                              String,
    `data__WWW-Home-Page`                         String,
    data__msip_labels                             String,
    `data__Reply-to`                              String,
    `data__Jabber-ID`                             String,
    `data__HTTP-Posting-Client`                   String,
    `data__HTTP-Posting-URI`                      String,
    `data__HTTP-Posting-User-Agent`               String,
    data__Xmailer                                 String,
    `data__Reply-By`                              String,
    data__Organisation                            String,
    data__RECEIVED                                String,
    data__Gcc                                     String,
    `data__Apparently-To`                         String,
    `data__Content-Description`                   String,
    data__Blat                                    String,
    `data__System-Type`                           String,
    `data__HOP-COUNT`                             String,
    data__Accreditor                              String,
    data__MID                                     String,
    `data__Expiry-Date`                           String,
    data__XSpamLevel                              String,
    data__GEOMAN                                  String,
    `data__RT-Ticket`                             String,
    `data__Managed-by`                            String,
    `data__RT-Originator`                         String,
    `data__Originator-Info`                       String,
    data__Comment                                 String,
    data__hFrom                                   String,
    data__Reveived                                String,
    `data__Times-Square`                          String,
    data__dhsVerify                               String,
    `data__AI-Spam-Status`                        String,
    `data__ARC-Authentication-results`            String,
    `data__Content-id`                            String,
    `data__IronPort-Data`                         String,
    data__TO                                      String,
    `data__cse__tek__com-MailScanner-Information` String,
    `data__cse__tek__com-MailScanner`             String,
    `data__Followup-To`                           String,
    `data__content-transfer-encoding`             String,
    `data__Resent-X-Attribution`                  String,
    `data__Resent-X-Draft-From`                   String,
    `data__Posted-To`                             String,
    `data__Bounce-To`                             String,
    data__Referencs                               String,
    `data__Authentication-Results-Original`       String,
    search_key__message_id                        String,
    search_key__project_name                      String,
    search_key__mail_list_name                    String,
    search_key__updated_at                        Int64
)
    engine = Distributed('replicated', 'default', 'maillists_local', search_key__updated_at);

create table maillists_local on cluster replicated
(
    backend_name                                  String,
    backend_version                               String,
    perceval_version                              String,
    timestamp                                     Float64,
    origin                                        String,
    uuid                                          String,
    updated_on                                    Float64,
    classified_fields_filtered                    Array(Array(String)),
    category                                      String,
    tag                                           String,
    metadata__updated_on                          DateTime64(3),
    metadata__timestamp                           DateTime64(3),
    search_fields__item_id                        String,
    data__unixfrom                                String,
    data__From                                    String,
    data__Subject                                 String,
    `data__In-Reply-To`                           String,
    data__References                              String,
    data__body__plain                             String,
    `data__Message-ID`                            String,
    data__Date                                    DateTime64(3),
    data__Date_tz                                 Int64,
    data__Received                                String,
    `data__DKIM-Signature`                        String,
    `data__MIME-Version`                          String,
    data__To                                      String,
    data__Cc                                      String,
    `data__Content-Type`                          String,
    `data__Received-SPF`                          String,
    data__Precedence                              String,
    `data__List-Id`                               String,
    `data__List-Unsubscribe`                      String,
    `data__List-Archive`                          String,
    `data__List-Post`                             String,
    `data__List-Help`                             String,
    `data__List-Subscribe`                        String,
    `data__User-Agent`                            String,
    `data__Content-Transfer-Encoding`             String,
    `data__MIME-version`                          String,
    `data__Content-transfer-encoding`             String,
    `data__Content-type`                          String,
    `data__Content-Disposition`                   String,
    `data__Content-Language`                      String,
    `data__Reply-To`                              String,
    data__CC                                      String,
    `data__Thread-Index`                          String,
    `data__Mail-Followup-To`                      String,
    `data__Authentication-Results`                String,
    `data__Resent-From`                           String,
    `data__Resent-Date`                           String,
    `data__Resent-Message-ID`                     String,
    `data__Resent-To`                             String,
    data__Importance                              String,
    `data__IronPort-SDR`                          String,
    `data__Content-Length`                        String,
    `data__Content-ID`                            String,
    `data__Mime-Version`                          String,
    `data__ARC-Seal`                              String,
    `data__ARC-Message-Signature`                 String,
    `data__ARC-Authentication-Results`            String,
    `data__Thread-Topic`                          String,
    `data__Accept-Language`                       String,
    `data__authentication-results`                String,
    data__Bcc                                     String,
    `data__DomainKey-Signature`                   String,
    data__Autocrypt                               String,
    data__Organization                            String,
    data__suggested_attachment_session_id         String,
    `data__Original-Sender`                       String,
    `data__Resent-CC`                             String,
    `data__Resent-Sender`                         String,
    data__Sender                                  String,
    `data__Errors-To`                             String,
    data__acceptlanguage                          String,
    data__Lines                                   String,
    `data__Resent-Message-Id`                     String,
    data__Face                                    String,
    data__Copyright                               String,
    data__OpenPGP                                 String,
    `data__OpenPGP-Fingerprint`                   String,
    `data__Content-disposition`                   String,
    `data__In-reply-to`                           String,
    data__Emacs                                   String,
    `data__Content-language`                      String,
    `data__Mail-Copies-To`                        String,
    `data__thread-index`                          String,
    `data__Thread-topic`                          String,
    `data__Thread-index`                          String,
    `data__Content-class`                         String,
    `data__content-class`                         String,
    `data__Cancel-Lock`                           String,
    `data__Content-Class`                         String,
    data__Priority                                String,
    `data__Delivered-To`                          String,
    `data__Mime-version`                          String,
    `data__Full-Name`                             String,
    data__HC                                      String,
    `data__ReSent-Date`                           String,
    `data__ReSent-From`                           String,
    `data__ReSent-To`                             String,
    `data__ReSent-Subject`                        String,
    `data__ReSent-Message-ID`                     String,
    `data__ReSent-User-Agent`                     String,
    data__importance                              String,
    data__Comments                                String,
    data__xOriginalSenderIP                       String,
    `data__Ligue-dja`                             String,
    `data__mime-version`                          String,
    data__from                                    String,
    data__sender                                  String,
    data__to                                      String,
    `data__Message-Context`                       String,
    `data__Mail-followup-to`                      String,
    data__Openpgp                                 String,
    `data__dkim-signature`                        String,
    `data__Hebrew-Date`                           String,
    `data__user-agent`                            String,
    `data__received-spf`                          String,
    data__spamdiagnosticoutput                    String,
    data__spamdiagnosticmetadata                  String,
    `data__DMARC-Filter`                          String,
    `data__DKIM-Filter`                           String,
    `data__Feedback-ID`                           String,
    data__Sensitivity                             String,
    `data__IronPort-PHdr`                         String,
    data__amddisc                                 String,
    data__SpamDiagnosticOutput                    String,
    data__SpamDiagnosticMetadata                  String,
    `data__Envelope-From`                         String,
    `data__Content-description`                   String,
    data__bn1pr05mb937                            String,
    `data__Authentication-Result`                 String,
    `data__dlp-product`                           String,
    `data__dlp-version`                           String,
    `data__dlp-reaction`                          String,
    data__MTA                                     String,
    data__EDITOR                                  String,
    data__cc                                      String,
    `data__Read-Receipt-To`                       String,
    `data__Mail-Reply-To`                         String,
    `data__PGP-Key`                               String,
    `data__User-agent`                            String,
    data__X_CMAE_Category                         String,
    data__Accept                                  String,
    data__Path                                    String,
    data__Newsgroups                              String,
    `data__IronPort-HdrOrdr`                      String,
    data__Originator                              String,
    data__Author                                  String,
    data__BlahBlahBlah                            String,
    data__Expires                                 String,
    data__Outgoingd                               String,
    `data__Resent-User-Agent`                     String,
    `data__Date-MUA`                              String,
    `data__WWW-Home-Page`                         String,
    data__msip_labels                             String,
    `data__Reply-to`                              String,
    `data__Jabber-ID`                             String,
    `data__HTTP-Posting-Client`                   String,
    `data__HTTP-Posting-URI`                      String,
    `data__HTTP-Posting-User-Agent`               String,
    data__Xmailer                                 String,
    `data__Reply-By`                              String,
    data__Organisation                            String,
    data__RECEIVED                                String,
    data__Gcc                                     String,
    `data__Apparently-To`                         String,
    `data__Content-Description`                   String,
    data__Blat                                    String,
    `data__System-Type`                           String,
    `data__HOP-COUNT`                             String,
    data__Accreditor                              String,
    data__MID                                     String,
    `data__Expiry-Date`                           String,
    data__XSpamLevel                              String,
    data__GEOMAN                                  String,
    `data__RT-Ticket`                             String,
    `data__Managed-by`                            String,
    `data__RT-Originator`                         String,
    `data__Originator-Info`                       String,
    data__Comment                                 String,
    data__hFrom                                   String,
    data__Reveived                                String,
    `data__Times-Square`                          String,
    data__dhsVerify                               String,
    `data__AI-Spam-Status`                        String,
    `data__ARC-Authentication-results`            String,
    `data__Content-id`                            String,
    `data__IronPort-Data`                         String,
    data__TO                                      String,
    `data__cse__tek__com-MailScanner-Information` String,
    `data__cse__tek__com-MailScanner`             String,
    `data__Followup-To`                           String,
    `data__content-transfer-encoding`             String,
    `data__Resent-X-Attribution`                  String,
    `data__Resent-X-Draft-From`                   String,
    `data__Posted-To`                             String,
    `data__Bounce-To`                             String,
    data__Referencs                               String,
    `data__Authentication-Results-Original`       String,
    search_key__message_id                        String,
    search_key__project_name                      String,
    search_key__mail_list_name                    String,
    search_key__updated_at                        Int64
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/maillists', '{replica}')
        PARTITION BY search_key__mail_list_name
        ORDER BY (search_key__message_id, search_key__project_name, search_key__mail_list_name)
        SETTINGS index_granularity = 8192;

drop table maillists_enriched_local on cluster replicated;
drop table maillists_enriched on cluster replicated;

create table maillists_enriched on cluster replicated
(
    metadata__updated_on        DateTime64(3),
    metadata__timestamp         DateTime64(3),
    offset                      Int64,
    origin                      String,
    tag                         String,
    uuid                        String,
    Date                        DateTime64(3),
    Subject                     String,
    `Message-ID`                String,
    Subject_analyzed            String,
    email_date                  DateTime64(3),
    list                        String,
    root                        Int64,
    body_extract                String,
    size                        Int64,
    tz                          Int64,
    mbox_author_domain          String,
    repository_labels           Array(String),
    metadata__filter_raw        String,
    grimoire_creation_date      DateTime64(3),
    is_mbox_message             Int64,
    metadata__gelk_version      String,
    metadata__gelk_backend_name String,
    metadata__enriched_on       DateTime64(3),
    Date_tz                     Int64,
    email_date_tz               Int64,
    metadata__enriched_on_tz    Int64,
    grimoire_creation_date_tz   Int64,
    From                        String,
    References                  String,
    `In-Reply-To`               String,
    To                          String,
    is_pipermail_message        Int64,
    search_key__message_id      String,
    search_key__project_name    String,
    search_key__mail_list_name  String,
    search_key__updated_at      Int64,
    from_email_domain           String,
    from_email_account          String,
    from_email_full_name        String
)
    engine = Distributed('replicated', 'default', 'maillists_enriched_local', search_key__updated_at);

create table maillists_enriched_local on cluster replicated
(
    metadata__updated_on        DateTime64(3),
    metadata__timestamp         DateTime64(3),
    offset                      Int64,
    origin                      String,
    tag                         String,
    uuid                        String,
    Date                        DateTime64(3),
    Subject                     String,
    `Message-ID`                String,
    Subject_analyzed            String,
    email_date                  DateTime64(3),
    list                        String,
    root                        Int64,
    body_extract                String,
    size                        Int64,
    tz                          Int64,
    mbox_author_domain          String,
    repository_labels           Array(String),
    metadata__filter_raw        String,
    grimoire_creation_date      DateTime64(3),
    is_mbox_message             Int64,
    metadata__gelk_version      String,
    metadata__gelk_backend_name String,
    metadata__enriched_on       DateTime64(3),
    Date_tz                     Int64,
    email_date_tz               Int64,
    metadata__enriched_on_tz    Int64,
    grimoire_creation_date_tz   Int64,
    From                        String,
    References                  String,
    `In-Reply-To`               String,
    To                          String,
    is_pipermail_message        Int64,
    search_key__message_id      String,
    search_key__project_name    String,
    search_key__mail_list_name  String,
    search_key__updated_at      Int64,
    from_email_domain           String,
    from_email_account          String,
    from_email_full_name        String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/maillists_enriched', '{replica}')
        PARTITION BY search_key__mail_list_name
        ORDER BY (search_key__project_name, search_key__mail_list_name)
        SETTINGS index_granularity = 8192;



create table metrics on cluster replicated
(
    owner                                 String,
    repo                                  String,
    github_id                             Int64,
    github_login                          String,
    git_author_email                      String,
    commit_times                          Int64,
    changed_lines                         Int64,
    diff_file_counts                      Int64,
    prs_counts                            Int64,
    pr_body_length_avg                    Float64,
    issues_counts                         Int64,
    issue_body_length_avg                 Float64,
    issues_comment_count                  Int64,
    issues_comment_body_length_avg        Float64,
    pr_comment_count                      Int64,
    pr_comment_body_length_avg            Float64,
    be_mentioned_times_in_issues          Int64,
    be_mentioned_times_in_pr              Int64,
    referred_other_issues_or_prs_in_issue Int64,
    referred_other_issues_or_prs_in_pr    Int64,
    changed_label_times_in_issues         Int64,
    changed_label_times_in_prs            Int64,
    closed_issues_times                   Int64,
    closed_prs_times                      Int64
)
    engine = Distributed('replicated', 'default', 'metrics_local', github_id);

create table metrics_local on cluster replicated
(
    owner                                 String,
    repo                                  String,
    github_id                             Int64,
    github_login                          String,
    git_author_email                      String,
    commit_times                          Int64,
    changed_lines                         Int64,
    diff_file_counts                      Int64,
    prs_counts                            Int64,
    pr_body_length_avg                    Float64,
    issues_counts                         Int64,
    issue_body_length_avg                 Float64,
    issues_comment_count                  Int64,
    issues_comment_body_length_avg        Float64,
    pr_comment_count                      Int64,
    pr_comment_body_length_avg            Float64,
    be_mentioned_times_in_issues          Int64,
    be_mentioned_times_in_pr              Int64,
    referred_other_issues_or_prs_in_issue Int64,
    referred_other_issues_or_prs_in_pr    Int64,
    changed_label_times_in_issues         Int64,
    changed_label_times_in_prs            Int64,
    closed_issues_times                   Int64,
    closed_prs_times                      Int64
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/metrics', '{replica}')
        PARTITION BY owner
        ORDER BY (owner, repo, github_id)
        SETTINGS index_granularity = 8192;

create table temp_gits_by_company on cluster replicated
(
    author_email_account    String,
    author_email_domain     String,
    author_github_login     String,
    author_github_id        Int64,
    committer_email_account String,
    committer_email_domain  String,
    committer_github_login  String,
    committer_github_id     Int64,
    search_key__owner       String,
    search_key__repo        String,
    search_key__origin      String,
    search_key__updated_at  Int64,
    message                 String,
    hexsha                  String,
    parents                 Array(String),
    author_tz               Int64,
    committer_tz            Int64,
    author_name             String,
    author_email            String,
    committer_name          String,
    committer_email         String,
    authored_date           DateTime64(3),
    authored_timestamp      Int64,
    committed_date          DateTime64(3),
    committed_timestamp     Int64,
    `files.insertions`      Array(Int64),
    `files.deletions`       Array(Int64),
    `files.lines`           Array(Int64),
    `files.file_name`       Array(String),
    total__insertions       Int64,
    total__deletions        Int64,
    total__lines            Int64,
    total__files            Int64,
    if_merged               Int64,
    type                    String
)
    engine = Distributed('replicated', 'default', 'temp_gits_by_company_local', search_key__updated_at);

create table temp_gits_by_company_local on cluster replicated
(
    author_email_account    String,
    author_email_domain     String,
    author_github_login     String,
    author_github_id        Int64,
    committer_email_account String,
    committer_email_domain  String,
    committer_github_login  String,
    committer_github_id     Int64,
    search_key__owner       String,
    search_key__repo        String,
    search_key__origin      String,
    search_key__updated_at  Int64,
    message                 String,
    hexsha                  String,
    parents                 Array(String),
    author_tz               Int64,
    committer_tz            Int64,
    author_name             String,
    author_email            String,
    committer_name          String,
    committer_email         String,
    authored_date           DateTime64(3),
    authored_timestamp      Int64,
    committed_date          DateTime64(3),
    committed_timestamp     Int64,
    `files.insertions`      Array(Int64),
    `files.deletions`       Array(Int64),
    `files.lines`           Array(Int64),
    `files.file_name`       Array(String),
    total__insertions       Int64,
    total__deletions        Int64,
    total__lines            Int64,
    total__files            Int64,
    if_merged               Int64,
    type                    String
)
    engine = ReplicatedMergeTree('/clickhouse/tables/{shard}/temp_gits_by_company', '{replica}')
        PARTITION BY search_key__owner
        ORDER BY (search_key__owner, search_key__repo, search_key__origin)
        SETTINGS index_granularity = 8192;

